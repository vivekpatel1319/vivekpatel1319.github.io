//tealium universal tag - utag.48 ut4.0.202006170527, Copyright 2020 Tealium.com Inc. All Rights Reserved.
try{(function(id,loader){var u={};utag.o[loader].sender[id]=u;if(utag===undefined){utag={};}if(utag.ut===undefined){utag.ut={};}if(utag.ut.loader===undefined){u.loader=function(o){var a,b,c,l;a=document;if(o.type==="iframe"){b=a.createElement("iframe");b.setAttribute("height","1");b.setAttribute("width","1");b.setAttribute("style","display:none");b.setAttribute("src",o.src);}else if(o.type==="img"){utag.DB("Attach img: "+o.src);b=new Image();b.src=o.src;return;}else{b=a.createElement("script");b.language="javascript";b.type="text/javascript";b.async=1;b.charset="utf-8";b.src=o.src;}if(o.id){b.id=o.id;}if(typeof o.cb==="function"){if(b.addEventListener){b.addEventListener("load",function(){o.cb();},false);}else{b.onreadystatechange=function(){if(this.readyState==="complete"||this.readyState==="loaded"){this.onreadystatechange=null;o.cb();}};}}l=o.loc||"head";c=a.getElementsByTagName(l)[0];if(c){utag.DB("Attach to "+l+": "+o.src);if(l==="script"){c.parentNode.insertBefore(b,c);}else{c.appendChild(b);}}};}else{u.loader=utag.ut.loader;}
u.ev={'view':1};u.initialized=false;u.map={"js_page.digitalData.transaction.transactionID":"order_id","js_page.digitalData.transaction.total.customerEmail":"customer_id","js_page.digitalData.transaction.total.transactionTotal":"order_total"};u.extend=[];u.send=function(a,b){if(u.ev[a]||u.ev.all!==undefined){var c,d,e,f,i;u.data={customer_id:"",order_id:"",order_total:"0.0"};for(d in utag.loader.GV(u.map)){if(b[d]!==undefined&&b[d]!==""){e=u.map[d].split(",");for(f=0;f<e.length;f++){u.data[e[f]]=b[d];}}}
var now=new Date();var spSrcUrl="https://d761erxl2qywg.cloudfront.net/sp.js?v="+now.getMonth()+"-"+now.getDate();(function(p,l,o,w,i,n,g){if(!p[i]){p.GlobalSnowplowNamespace=p.GlobalSnowplowNamespace||[];p.GlobalSnowplowNamespace.push(i);p[i]=function(){(p[i].q=p[i].q||[]).push(arguments)};p[i].q=p[i].q||[];n=l.createElement(o);g=l.getElementsByTagName(o)[0];n.async=1;n.src=w;g.parentNode.insertBefore(n,g);}}(window,document,"script",spSrcUrl,"snowplow"));window.clarioTrackerData={collector:"clario.ftd.com",app_id:"6210",customer_id:"",order_affiliation:"FTD"};var dd=window.digitalData||{};if(dd.user&&dd.user.profile&&dd.user.profile.profileInfo){window.clarioTrackerData.customer_id=dd.user.profile.profileInfo.customerID||dd.user.profile.profileInfo.legacyFlCustId;}
if(dd.transaction&&dd.transaction.transactionID){window.clarioTrackerData.order_id=dd.transaction.transactionID;window.clarioTrackerData.order_total=dd.transaction.total.transactionTotal;window.clarioTrackerData.order_tax=""+Number(dd.transaction.total.transactionTotal-dd.transaction.total.transactionTotalNoTax).toFixed(2);window.clarioTrackerData.order_shipping=dd.transaction.total.shipping;if(!window.clarioTrackerData.customer_id){window.clarioTrackerData.customer_id=dd.transaction.total.customerEmail;}
var orderContext=[];var total=dd.transaction.total;if(total.shippingMethod){orderContext.push({name:"shippingMethod",value:[""+total.shippingMethod]});}
if(total.discountapplied){orderContext.push({name:"discountapplied",value:[""+total.discountapplied]});}
if(total.voucherDiscount){orderContext.push({name:"voucherDiscount",value:[""+total.voucherDiscount]});}
window.clarioTrackerData.order_context=orderContext;var items=[];dd.transaction.product.forEach(function(product){var context=[];for(var key in product){if(key.toLowerCase().includes("addon")){context.push({name:key,value:[""+product[key]]});}}
if(product.productRegularPrice){context.push({name:"productRegularPrice",value:[""+product.productRegularPrice]});}
if(context.length){context=[{schema:"iglu:io.clar/transaction/jsonschema/1-0-0",data:{transaction:context}}];}else{context=null;}
items.push({orderId:dd.transaction.transactionID,sku:product.productID,name:product.productName,price:""+product.productCurrentPrice,quantity:"1",context:context});})
window.clarioTrackerData.order_items=items;}
window.snowplow("newTracker","cf",window.clarioTrackerData.collector||"c.clario.us",{appId:window.clarioTrackerData.app_id,platform:"web",discoverRootDomain:true,stateStorageStrategy:"localStorage",post:true,contexts:{webPage:true,performanceTiming:true,gaCookies:true,geolocation:false}});function find(items,fn){return items.filter(fn)[0]}
window.snowplow('setUserId',window.clarioTrackerData.customer_id);var hits=[];var allTheCookies=document.cookie.split(";");["_fbp","_ga"].forEach(function(term){var found=find(allTheCookies,function(cookie){return cookie.indexOf(term+"=")>=0;});if(found){var parts=found.split("=");if(parts.length==2){hits.push({name:term,value:parts[1]});}}});if(hits.length){window.snowplow('trackPageView',null,[{schema:"iglu:io.clar/cookies/jsonschema/2-0-0",data:{cookies:hits}}]);}else{window.snowplow('trackPageView');}
if(window.clarioTrackerData.order_id){var context=null;if(window.clarioTrackerData.order_context){context=[{schema:"iglu:io.clar/transaction/jsonschema/1-0-0",data:{transaction:window.clarioTrackerData.order_context}}]}
window.snowplow('addTrans',window.clarioTrackerData.order_id,window.clarioTrackerData.order_affiliation,window.clarioTrackerData.order_total,window.clarioTrackerData.order_tax||"",window.clarioTrackerData.order_shipping||"","","","","",context);if(window.clarioTrackerData.order_items){window.clarioTrackerData.order_items.forEach(function(item){window.snowplow('addItem',item.orderId,item.sku,item.name,"",item.price,item.quantity,"",item.context||"");});}
window.snowplow('trackTrans');}
if(window.clarioTrackerData.gum_id){try{var collector=window.clarioTrackerData.collector||"c.clario.us";var gumUrl="https://gum.criteo.com/sync?c="+window.clarioTrackerData.gum_id+"&r=1&a=1&u=";Object.keys(localStorage).forEach(function(key){if(key.search(/_sp_id\.\w/)>=0){window.clarioTrackerData.sp_id=localStorage.getItem(key);}});if(!window.clarioTrackerData.sp_id){var cookieAry=document.cookie.split(";");var found=find(cookieAry,function(cookie){return cookie.search(/_sp_id\..*=/)>=0;});if(found){window.clarioTrackerData.sp_id=found.split("=")[1].split(".")[0];}}
var redirectUrl="https://"+
collector+
"/i?aid="+
window.clarioTrackerData.app_id+
"&e=se&p=web&tv=2.10.2&se_ca=criteo&se_ac=cookie_match&se_la="+
window.clarioTrackerData.sp_id||""+
"&se_pr=@USERID@";var xhr=new XMLHttpRequest();xhr.open('GET',gumUrl+encodeURIComponent(redirectUrl),true);xhr.withCredentials=true;xhr.send();}catch(err){console.log("Error sending GUM request."+err)}}
}};utag.o[loader].loader.LOAD(id);})("48","providecommerce.ftd");}catch(error){utag.DB(error);}
